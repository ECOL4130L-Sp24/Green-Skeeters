---
title: "Deliverable 3 Data Analyses"
output: uhhh
date: "2024-03-14"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE)
```

## ANOVA comparing temperature and mosquito pathogen positivity across sites

```{r}
# Loading appropriate packages

library(tidyverse)
library(here)
library(cowplot)
library(viridis)
```

```{r}
# Read in data

temp_day <- read_csv(here("data", "processed", "temp_day.csv"))
mosquito_clean <- read_csv(here("data", "processed", "mosquito_clean.csv"))
rodent_clean <- read_csv(here("data", "processed", "rodent_clean.csv"))

# Preview the data
```

```{r}
#Convert rodent and mosquito test data into binary values
mosquito_binary <- mosquito_clean %>% 
  mutate(testResult_mos= ifelse(testResult=="Positive",1,0))

rodent_binary <- rodent_clean %>% 
  mutate(testResult_rodent= ifelse(testResult=="Positive",1,0))
```

```{r}
#Saving positive/negative binary data to processed data folder
mosquito_binary %>% 
  write_csv(here("data", "processed", "mosquito_binary.csv"))

rodent_binary %>% 
  write_csv(here("data", "processed", "rodent_binary.csv"))
```

```{r}
#Join data sheets
mosquito_day <- mosquito_clean %>% 
  select(-startCollectDate) %>% 
  mutate(collectDate = as_date(endCollectDate)) %>% 
  select(-endCollectDate) 

temp_day_join <-temp_day %>% 
  rename("collectDate"= `floor_date(startDateTime, "day")`)

temp_mos_raw <-
  full_join(mosquito_binary, temp_day_join) %>% 
  full_join(., rodent_binary) %>% 
  select(-testResult)

temp_mos_raw %>% 
  write_csv(here("data", "processed", "temp_mos_raw.csv"))

```

```{r}
#ANOVA time

temp_mos_proportion <- temp_mos_raw %>%
  group_by(siteID, testResult_mos) %>% 
  drop_na(testResult_mos) %>% 
summarize(count = n()) %>% 
  pivot_wider(names_from = testResult_mos, values_from = count,
              values_fill = 0) %>% 
  rename( negative = `0`, positive = `1`) %>% 
  mutate(prop_positive = `positive`/(`positive` + `negative`)) %>% 
 

 site_mos_aov <- model2 <- aov(prop_positive ~ siteID, data = temp_mos_proportion)

```

```{r}
#Validate assumptions in ANOVA, view summary
summary(site_mos_aov)
TukeyHSD(site_mos_aov)

```