---
title: "Deliverable 3 Data Analyses"
output: uhhh
date: "2024-03-14"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE)
```

## ANOVA comparing temperature and mosquito pathogen positivity across sites

```{r}
# Loading appropriate packages

library(tidyverse)
library(here)
library(cowplot)
library(viridis)
```

```{r}
# Read in data

temp_day <- read_csv(here("data", "processed", "temp_day.csv"))
mosquito_clean <- read_csv(here("data", "processed", "mosquito_clean.csv"))
rodent_clean <- read_csv(here("data", "processed", "rodent_clean.csv"))

# Preview the data
```

```{r}
#Convert rodent and mosquito test data into binary values
mosquito_binary <- mosquito_clean %>% 
  mutate(testResult_mos= ifelse(testResult=="Positive",1,0))

rodent_binary <- rodent_clean %>% 
  mutate(testResult_rodent= ifelse(testResult=="Positive",1,0))
```

```{r}
#Saving positive/negative binary data to processed data folder
mosquito_binary %>% 
  write_csv(here("data", "processed", "mosquito_binary.csv"))

rodent_binary %>% 
  write_csv(here("data", "processed", "rodent_binary.csv"))
```

```{r}
#Join data sheets
mosquito_day <- mosquito_clean %>% 
  select(-startCollectDate) %>% 
  mutate(collectDate = as_date(endCollectDate)) %>% 
  select(-endCollectDate) 

temp_day_join <-temp_day %>% 
  rename("collectDate"= `floor_date(startDateTime, "day")`)

temp_mos_raw <-
  full_join(mosquito_binary, temp_day_join) %>% 
  select(-testResult)

temp_mos_raw #%>% 
  #write_csv(here("data", "processed", "temp_mos_raw.csv"))

temp_mos_season <- temp_mos_raw %>% 
  subset %>% 
  mutate(month = month(collectDate),
         season = ifelse(month %in% c(06,07,08), "summer",
                         ifelse(month %in% c(09,10,11), "fall",
                                ifelse(month %in% c(12,01,02), "winter",
                                        ifelse(month %in% c(03,04,05), "spring",
                                                "NA")))))

```

```{r}
#Performing an ANOVA on test results with season and site id
model1 <- aov(testResult_mos ~ siteID * season, data = temp_mos_season)

summary(model1)

TukeyHSD(model1)

par(mfrow = c(1, 2))
plot(model1, which = c(2, 3))
```

```{r}
ggplot(temp_mos_season,
ggplot(data = temp_mos_season, 
         aes(x = season, 
             y = testResult_mos))) +
  #geom_jitter(aes(col = siteID),
  #            width = 0.2) +
  geom_boxplot(fill = NA, 
               outlier.shape = NA) +
  theme_bw()
```

```{r}
#Validate assumptions in ANOVA, view summary
summary(site_mos_aov)
TukeyHSD(site_mos_aov)

```

```{r}
ggplot(temp_mos_proportion,
       aes(x = siteID, 
           y = testResult_mos)) +
  geom_jitter(data = temp_mos_season,
              aes(x = siteID, 
                  y = testResult_mos,
                  col = season))

 #This graph is currently unfinished and needs a good bit of work 
```

```{r}
ggplot(data = temp_mos_season, 
         aes(x = season, 
             y = testResult_mos)) +
  geom_jitter(aes(col = siteID),
          width = 0.2) +
  scale_y_continuous(limits = c(0, 0.5)) +
  theme_bw()
```

